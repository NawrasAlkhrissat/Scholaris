<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Students | SMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/students.css">
</head>

<body>

    <%- include('./partials/nav.ejs') %>
    
        <div class="dashboard-container">

            <aside class="sidebar">
                <div class="sidebar-title">Main Menu</div>
                <a href="/school/user/<%= userId %>" class="sidebar-link"><span>üë§</span><span>My
                        Profile</span></a>
                <a href="/school" class="sidebar-link active"><span>üè´</span><span>My School</span></a>
                <a href="/school/subject" class="sidebar-link"><span>üìö</span><span>
                        <%= role=='admin' ? 'All Subjects' : 'My Subjects' %>
                    </span></a>
                <a href="/school/academic-calendar" class="sidebar-link"><span>üìÖ</span><span>Calendar</span></a>
            </aside>

            <main class="main-content">
                 <% if(role === 'admin'){ %>
            <a href="/school/dashboard" class="back-link">
                                <span>&larr;</span> Back to Dashboard
                            </a>
            <% } %>
                <header class="page-header">
                    <div class="header-title">
                        <h1>All Students</h1>
                        <p>Manage and view student profiles</p>
                    </div>

                    <div class="header-actions">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="searchInput" class="search-input" placeholder="Search students..."
                                onkeyup="filterStudents()">
                        </div>
                        <a href="/school/student/add" class="btn-add"><span>‚ûï</span> Add Student</a>
                    </div>
                </header>

                <div class="students-grid" id="studentsGrid">
                    <% if( students && students.length> 0) { %>
                        <% students.forEach((student)=> { %>    
                            <div class="student-card" data-name="<%= student.name.toLowerCase() %>">
                                <img src="https://ui-avatars.com/api/?name=<%= student.name %>&background=random&color=fff&size=128"
                                    alt="<%= student.name %>" class="student-avatar">

                                <h3 class="student-name">
                                    <%= student.name %>
                                </h3>

                                <% if(student.currentClass) { %>
                                    <span class="student-class class-assigned">
                                        üè´ <%= student.currentClass.className %>
                                    </span>
                                    <% } else { %>
                                        <span class="student-class class-none">
                                            ‚ö†Ô∏è No Class Assigned
                                        </span>
                                        <% } %>

                                            <a href="/school/student/<%= student._id %>" class="btn-view">
                                                View Details &rarr;
                                            </a>
                            </div>
                            <% }) %>
                                <% } %>

                                    <div id="noResultsMsg" class="no-results">
                                        <p>No students found matching your search.</p>
                                    </div>

                                    <% if(students.length===0) { %>
                                        <div
                                            style="grid-column: 1 / -1; text-align: center; padding: 50px; color: #999;">
                                            <h3>No students registered yet.</h3>
                                            <p>Click "Add Student" to get started.</p>
                                        </div>
                                        <% } %>
                </div>

            </main>
        </div>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script>
            function filterStudents() {
                const input = document.getElementById('searchInput');
                const filter = input.value.toLowerCase();
                const grid = document.getElementById('studentsGrid');
                const cards = grid.getElementsByClassName('student-card');
                const noResultsMsg = document.getElementById('noResultsMsg');
                let visibleCount = 0;

                for (let i = 0; i < cards.length; i++) {
                    const name = cards[i].getAttribute('data-name');
                    if (name.indexOf(filter) > -1) {
                        cards[i].style.display = "flex";
                        visibleCount++;
                    } else {
                        cards[i].style.display = "none";
                    }
                }
                if (visibleCount === 0 && cards.length > 0) {
                    noResultsMsg.style.display = 'block';
                } else {
                    noResultsMsg.style.display = 'none';
                }
            }
        </script>
    <% if(action && action.includes('deletedStudent')){ %>
        <script>
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });
            Toast.fire({
                icon: "success",
                title: "Student deleted successfully"
            });
        </script>
        <% } %>
</body>

</html>