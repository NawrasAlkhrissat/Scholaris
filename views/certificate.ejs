<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Report Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <base href="file:///C:/Users/admin/Desktop/school_Project/public/">
    
    <style>
        /* --- 1. إعدادات الصفحة الصارمة (A4 Exact) --- */
        @page {
            size: A4;
            margin: 0; /* الهوامش صفر لأننا نتحكم بها في الـ CSS */
        }

        /* --- 2. إعدادات الطباعة العامة --- */
        * {
            box-sizing: border-box;
            -webkit-print-color-adjust: exact !important; /* فرض طباعة الألوان */
            print-color-adjust: exact !important;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #fff; /* خلفية بيضاء دائماً */
            font-family: 'Cairo', sans-serif;
            color: #2c3e50;
        }

        /* --- 3. حاوية الصفحة (A4 Page Container) --- */
        /* هذه الكلاس تمثل ورقة A4 واحدة بالضبط */
        .sheet {
            width: 210mm;
            height: 296mm; /* 296 بدل 297 لتجنب صفحة فارغة إضافية بسبب التقريب */
            position: relative;
            overflow: hidden; /* أي شيء خارج الورقة يتم قصه */
            page-break-after: always; /* اجبار الانتقال لصفحة جديدة بعد كل ورقة */
            background: white;
        }

        /* الصفحة الأخيرة لا تحتاج لفاصل بعدها */
        .sheet:last-of-type {
            page-break-after: auto;
        }

        /* --- 4. الإطار والزخارف (Absolute Positioning) --- */
        /* نستخدم الوضع المطلق لضمان ثبات الإطار بغض النظر عن المحتوى */
        .border-frame {
            position: absolute;
            top: 10mm;
            left: 10mm;
            right: 10mm;
            bottom: 10mm;
            border: 3px double #1a237e; /* Primary Color */
            z-index: 10;
            pointer-events: none; /* للسماح بتحديد النص داخله */
        }

        .corner {
            position: absolute;
            width: 30px;
            height: 30px;
            background: white;
            border: 4px solid #1a237e;
            z-index: 11;
        }
        .tl { top: -2px; left: -2px; border-right: 0; border-bottom: 0; }
        .tr { top: -2px; right: -2px; border-left: 0; border-bottom: 0; }
        .bl { bottom: -2px; left: -2px; border-right: 0; border-top: 0; }
        .br { bottom: -2px; right: -2px; border-left: 0; border-top: 0; }

        /* --- 5. العلامة المائية --- */
        .watermark {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            opacity: 0.05;
            z-index: 1;
            filter: grayscale(100%);
        }

        /* --- 6. محتوى الصفحة (Content Wrapper) --- */
        .content-layer {
            position: relative;
            z-index: 5;
            padding: 20mm; /* حشوة داخلية للمحتوى */
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* --- المتغيرات والتنسيقات الداخلية --- */
        :root {
            --primary: #1a237e;
            --accent: #c5a059;
            --text-gray: #7f8c8d;
        }

        /* Header */
        .header {
            display: flex; justify-content: space-between; align-items: flex-start;
            border-bottom: 3px double #e0e0e0; padding-bottom: 20px; margin-bottom: 30px;
        }
        .school-info h2 { margin: 0; color: var(--primary); font-size: 1.4rem; text-transform: uppercase; }
        .school-info p { margin: 2px 0; font-size: 0.85rem; color: #555; }
        .logo-img { width: 100px; height: auto; }
        .meta-info { text-align: right; }
        .meta-info p { margin: 3px 0; font-size: 0.9rem; font-weight: 600; }

        /* Title */
        .report-title { text-align: center; margin-bottom: 30px; }
        .report-title h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--primary); margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .report-title span { display: block; width: 100px; height: 3px; background: var(--accent); margin: 8px auto 0; }

        /* Student Details */
        .student-box {
            background-color: #f8f9fa; border: 1px solid #eee; border-left: 5px solid var(--accent);
            padding: 25px; border-radius: 8px; display: grid; grid-template-columns: 1fr; gap: 15px;
            font-size: 1rem;
        }
        .row { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding-bottom: 5px; }
        .lbl { font-weight: 700; color: var(--text-gray); text-transform: uppercase; font-size: 0.85rem; }
        .val { font-weight: 700; color: var(--primary); }

        /* Status Badge */
        .status-area { margin-top: auto; text-align: center; padding-bottom: 20px; }
        .status-badge {
            display: inline-block; padding: 10px 50px; border-radius: 50px; color: white;
            font-weight: 800; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 2px;
        }

        /* Grades Table */
        .grades-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        .grades-table th { background-color: var(--primary); color: white; padding: 12px; text-align: left; text-transform: uppercase; }
        .grades-table td { padding: 10px 12px; border-bottom: 1px solid #eee; font-weight: 600; color: #333; }
        .grades-table tr:nth-child(even) { background-color: #f8f9fa; }

        /* GPA */
        .gpa-area { display: flex; justify-content: flex-end; margin-top: 30px; }
        .gpa-card {
            border: 2px solid var(--primary); border-radius: 10px; padding: 15px 40px; text-align: center;
        }
        .gpa-title { font-size: 0.9rem; text-transform: uppercase; color: #777; font-weight: 700; }
        .gpa-num { font-size: 2.2rem; font-weight: 800; color: var(--accent); line-height: 1.1; }
        </style>
</head>


<body>

    <div class="sheet">
        <div class="border-frame">
            <div class="corner tl"></div><div class="corner tr"></div>
            <div class="corner bl"></div><div class="corner br"></div>
        </div>

        <img src="data:image/jpg;base64,<%= logoBase64 %>" class="watermark" alt="Watermark">

        <div class="content-layer">
            
            <header class="header">
                <div class="school-info">
                    <h2><%= school.name %></h2>
                    <p><%= school.address %></p>
                    <p>Phone: <%= school.contacts.phone %></p>
                    <p>Email: <%= school.contacts.email %></p>
                </div>
                <div class="logo-container">
                    <img src="data:image/jpg;base64,<%= logoBase64 %>" alt="Logo" class="logo-img">
                </div>
                <div class="meta-info">
                    <p>Academic Year: <%= academicYear %></p>
                    <p>Semester: <%= semester %></p>
                    <p>Date: <%= new Date().toLocaleDateString() %></p>
                </div>
            </header>

            <div class="report-title">
                <h1>Official Transcript</h1>
                <span></span>
            </div>

            <div class="student-box">
                <div class="row"><span class="lbl">Student Name</span> <span class="val"><%= student.name %></span></div>
                <div class="row"><span class="lbl">National ID</span> <span class="val"><%= student.nationalId %></span></div>
                <div class="row"><span class="lbl">Grade / Class</span> <span class="val"><%= cls.className %></span></div>
                <div class="row"><span class="lbl">Date of Birth</span> <span class="val"><%= new Date(student.dateOfBirth).toLocaleDateString() %></span></div>
                <div class="row"><span class="lbl">Gender</span> <span class="val" style="text-transform: capitalize;"><%= student.gender %></span></div>
                <div class="row"><span class="lbl">Homeroom Teacher</span> <span class="val"><%= cls.responsibleTeacher.firstName %> <%= cls.responsibleTeacher.lastName %></span></div>
            </div>
            
            <div class="status-area">
                <div style="margin-bottom: 10px; color:#7f8c8d; font-weight:600; text-transform:uppercase;">Academic Standing</div>
                <div class="status-badge" style="background-color: <% if(finalResult.status == 'pass') { %>#27ae60<% } else { %>#e74c3c<% } %>; color:#e0e0e0 ;">
                    <%= finalResult.status %>
                </div>
            </div>

        </div>
    </div>

    <div class="sheet">
        <div class="border-frame">
            <div class="corner tl"></div><div class="corner tr"></div>
            <div class="corner bl"></div><div class="corner br"></div>
        </div>

        <img src="data:image/jpg;base64,<%= logoBase64 %>" class="watermark" alt="Watermark">

        <div class="content-layer">
            
            <div class="report-title" style="margin-top: 10px;">
                <h1>Academic Performance</h1>
                <span></span>
            </div>

            <table class="grades-table">
                <thead>
                    <tr>
                        <th width="40%">Subject</th>
                        <th width="20%" style="text-align: center;">Marks (100)</th>
                        <th width="20%" style="text-align: center;">Grade</th>
                        <th width="20%">Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    <% marks.forEach(mark => { %>
                    <tr>
                        <td><%= mark.subjectName %></td>
                        <td style="text-align: center;"><%= mark.score %></td>
                        <td style="text-align: center; font-weight: bold;">
                            <% if(mark.score >= 90) { %> <span style="color:#1a237e;">A</span>
                            <% } else if(mark.score >= 80) { %> <span style="color:#1a237e;">B</span>
                            <% } else if(mark.score >= 70) { %> <span style="color:#333;">C</span>
                            <% } else if(mark.score >= 60) { %> <span style="color:#333;">D</span>
                            <% } else { %> <span style="color:#c0392b;">F</span> <% } %>
                        </td>
                        <td>
                            <% if(mark.score >= 50) { %>
                                <span style="color:#27ae60; font-weight:bold;">Pass</span>
                            <% } else { %>
                                <span style="color:#c0392b; font-weight:bold;">Fail</span>
                            <% } %>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>

            <div class="gpa-area">
                <div class="gpa-card">
                    <div class="gpa-title">Final GPA / Average</div>
                    <div class="gpa-num"><%= finalResult.average %>%</div>
                </div>
            </div>

        </div>
    </div>

</body>
</html>