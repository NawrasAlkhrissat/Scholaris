<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Teacher</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/addUser.css">

</head>

<body>
    <%- include('./partials/nav.ejs') %>
    <div class="dashboard-container">
        <aside class="sidebar">
                <div class="sidebar-title">Main Menu</div>
                <a href="/school/user/<%= userId %>" class="sidebar-link"><span>üë§</span><span>My
                        Profile</span></a>
                <a href="/school" class="sidebar-link active"><span>üè´</span>My School</a>
                <a href="/school/subject" class="sidebar-link"><span>üìö</span><span>
                        <%= role=='admin' ? 'All Subjects' : 'My Subjects' %>
                    </span></a>
                <a href="/school/academic-calendar" class="sidebar-link"><span>üìÖ</span><span>Calendar</span></a>
            </aside>
            <main class="main-content">
                <a href="/school/dashboard" class="back-link">
                    <span>&larr;</span> Back to Dashboard
                </a>
                <h1>Add New Teacher/Admin</h1>
                <form action="/school/user" method="POST" enctype="multipart/form-data">
                    <div class="edit-grid">
                        <div class="card photo-uploader">
                            <h3 style="margin-bottom: 20px; color: var(--primary-color);">Profile Photo</h3>
                            <div class="photo-preview-box" id="previewContainer"><span class="photo-placeholder"
                                    id="placeholderIcon">üì∑</span><img id="imagePreview" src="#" alt="Image Preview">
                            </div><label for="photoInput" class="btn-upload-label"><span>üìÇ</span>Choose
                                Photo</label><input type="file" name="photo" id="photoInput" accept="image/*"
                                style="display: none;" onchange="previewImage(this)"><button type="button"
                                id="removeBtn" class="btn-remove-photo" onclick="removeImage()">‚úñ Remove Photo</button>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 20px; color: var(--primary-color);">Teacher Information</h3>
                            <div class="form-grid-inner">
                                <div class="form-group"><label>First Name *</label><input type="text" name="firstName"
                                        class="form-input" placeholder="e.g. John" required></div>
                                <div class="form-group"><label>Last Name *</label><input type="text" name="lastName"
                                        class="form-input" placeholder="e.g. Doe" required></div>
                                <div class="form-group"><label>Email Address *</label><input type="email" name="email"
                                        class="form-input" placeholder="teacher@school.com" required></div>
                                <div class="form-group"><label>Phone Number</label><input type="text" name="phone"
                                        class="form-input" placeholder="+123456789"></div>
                                <div class="form-group"><label>Password *</label><input type="password" name="password"
                                        class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div>
                                <div class="form-group"><label>Confirm Password *</label><input type="password"
                                        name="confirmPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div>
                                <div class="form-group"><label>Teaching Subject(s)</label>
                                    <div class="multiselect-container" id="subjectsDropdown">
                                        <div class="select-box" onclick="toggleDropdown('subjectsList')"><span
                                                id="subjectsSelectedText">Select Subjects...</span></div>
                                        <div id="subjectsList" class="checkboxes-list">
                                            <% subjects.forEach(subject=> {%>
                                                <div class="checkbox-item" onclick="toggleCheckbox(this)"> <input
                                                        type="checkbox" name="subjects[]" value="<%= subject._id %>"
                                                        onchange="updateSelectedText('subjectsList', 'subjectsSelectedText')">
                                                    <label>
                                                        <%=subject.subjectName %> (<%= subject.class.className %>)
                                                    </label>
                                                </div>
                                                <% }) %>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group"><label>Assigned Class(es)</label>
                                    <div class="multiselect-container" id="classesDropdown">
                                        <div class="select-box" onclick="toggleDropdown('classesList')"><span
                                                id="classesSelectedText">Select Classes...</span></div>
                                        <div id="classesList" class="checkboxes-list">
                                            <% classes.forEach(cls=> {%>
                                                <div class="checkbox-item" onclick="toggleCheckbox(this)"> <input
                                                        type="checkbox" name="assignedClasses[]" value="<%= cls._id %>"
                                                        onchange="updateSelectedText('classesList', 'classesSelectedText')">
                                                    <label>
                                                        <%=cls.className %>
                                                    </label>
                                                </div>
                                                <% }) %>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                <select name="role" class="form-input">
                                    <option value="teacher" selected>Teacher</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                                <div class="form-group full-width"><label>Biography / Notes</label><textarea name="bio"
                                        class="form-textarea" placeholder="Write a short bio..."></textarea></div>
                            </div>
                            <div class="form-actions"><button type="submit" class="btn-submit">Add Teacher</button>
                            </div>
                        </div>
                    </div>
                </form>
            </main>
        </div>
        <script>
            const photoInput = document.getElementById('photoInput');
            const imagePreview = document.getElementById('imagePreview');
            const placeholderIcon = document.getElementById('placeholderIcon');
            const removeBtn = document.getElementById('removeBtn');

            function previewImage(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                        placeholderIcon.style.display = 'none';
                        removeBtn.style.display = 'block';
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            function removeImage() {
                photoInput.value = '';
                imagePreview.src = '#';
                imagePreview.style.display = 'none';
                placeholderIcon.style.display = 'block';
                removeBtn.style.display = 'none';
            }


            function toggleDropdown(listId) {
                const list = document.getElementById(listId);
                const isOpen = list.classList.contains('open');

                document.querySelectorAll('.checkboxes-list').forEach(el => el.classList.remove('open'));

                if (!isOpen) {
                    list.classList.add('open');
                }
            }

            function toggleCheckbox(div) {
                if (event.target.tagName === 'INPUT') return;

                const checkbox = div.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;

                checkbox.dispatchEvent(new Event('change'));
            }

            function updateSelectedText(listId, textId) {
                const list = document.getElementById(listId);
                const checkboxes = list.querySelectorAll('input[type="checkbox"]:checked');
                const textSpan = document.getElementById(textId);

                if (checkboxes.length === 0) {
                    textSpan.innerText = textId.includes('subjects') ? "Select Subjects..." : "Select Classes...";
                    textSpan.style.color = "#666";
                }

                else if (checkboxes.length <= 2) {
                    let names = [];

                    checkboxes.forEach(cb => {
                        names.push(cb.nextElementSibling.innerText);
                    });
                    textSpan.innerText = names.join(", ");
                    textSpan.style.color = "#333";
                }

                else {
                    textSpan.innerText = `${checkboxes.length} Selected`;
                    textSpan.style.color = "var(--primary-color)";
                    textSpan.style.fontWeight = "600";
                }
            }

            document.addEventListener('click', function (e) {
                if (!e.target.closest('.multiselect-container')) {
                    document.querySelectorAll('.checkboxes-list').forEach(el => el.classList.remove('open'));
                }
            });

        </script>
</body>

</html>